<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>PWM - Advanced Computer Engineering</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href=".././theme/pagetoc.css">
        <link rel="stylesheet" href=".././theme/css/mdbook-admonish.css">
        <link rel="stylesheet" href=".././theme/css/code.css">
        <link rel="stylesheet" href=".././theme/css/terminal.css">
        <link rel="stylesheet" href=".././theme/css/output.css">
        <link rel="stylesheet" href=".././theme/css/film.css">
        <link rel="stylesheet" href=".././theme/css/mdbook-admonish.css">

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="dracula">Dracula</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="frappe">Frapp√©</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="kanagawa">Knagawa</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="macchiato">Macchiato</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mocha">Mocha</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="pinkrose">Pinkrose</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="tender">Tender</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="tokyonight">Tokyonight</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Advanced Computer Engineering</h1>

                    <div class="right-buttons">
                        <a href="https://github.com/uniofgreenwich/ELEE1119_Exercises" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/uniofgreenwich/ELEE1119_Exercises/edit/main/content/EmbeddedC/pwm.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main><div class="sidetoc"><nav class="pagetoc"></nav></div>
                        <h1 id="pwm-workbook-configuring-pwm-on-the-atmega328p"><a class="header" href="#pwm-workbook-configuring-pwm-on-the-atmega328p">PWM Workbook: Configuring PWM on the ATmega328P</a></h1>
<h2 id="1-introduction-to-pwm-on-atmega328p"><a class="header" href="#1-introduction-to-pwm-on-atmega328p">1. Introduction to PWM on ATmega328P</a></h2>
<div id="admonition-info" class="admonition admonish-info" role="note" aria-labelledby="admonition-info-title">
<div class="admonition-title">
<div id="admonition-info-title">
<p>Info</p>
</div>
<a class="admonition-anchor-link" href="#admonition-info"></a>
</div>
<div>
<p>PWM is a technique to control the average power supplied to electronic components by varying the duty cycle of a square wave. The ATmega328P offers several timers that can generate PWM signals. In this workbook, we focus on using <code>Timer0</code> to generate an 8-bit PWM signal on <code>OC0A</code> (Pin <code>PD6</code>).</p>
</div>
</div>
<hr />
<h2 id="2-timer0-registers-for-pwm"><a class="header" href="#2-timer0-registers-for-pwm">2. <code>Timer0</code> Registers for PWM</a></h2>
<p><code>TCCR</code> stands for <strong>Timer/Counter Control Register</strong>. On the ATmega328P and similar microcontrollers, these registers control the behavior of each timer/counter module.</p>
<p>Each timer has one or more <code>TCCR</code> registers that configure aspects such as:</p>
<ul>
<li>PWM mode (e.g., Fast PWM, Phase Correct PWM)</li>
<li>Compare Output Mode (inverting or non-inverting PWM signal)</li>
<li>Clock source and prescaler (e.g., no prescaler, prescaler of 8, 64, etc.)</li>
</ul>
<h3 id="21-types-of-tccr-registers-on-atmega328p"><a class="header" href="#21-types-of-tccr-registers-on-atmega328p">2.1 Types of TCCR Registers on ATmega328P</a></h3>
<p>The ATmega328P has three timers, each with associated TCCR registers:</p>
<ol>
<li>
<p><code>Timer0</code> (8-bit):</p>
<ul>
<li><code>TCCR0A</code> and <code>TCCR0B</code>: These control the settings for <code>Timer0</code>, including PWM configuration, clock selection, and output modes.</li>
</ul>
</li>
<li>
<p><code>Timer1</code> (16-bit):</p>
<ul>
<li><code>TCCR1A</code> and <code>TCCR1B</code>: These control <code>Timer1</code>, which supports 16-bit resolutions. This is useful for applications needing finer control, such as precise PWM or high-resolution counters.</li>
</ul>
</li>
<li>
<p><code>Timer2</code> (8-bit):</p>
<ul>
<li><code>TCCR2A</code> and <code>TCCR2B</code>: These control <code>Timer2</code>, similar to <code>Timer0</code> but with different prescaler and clock source options.</li>
</ul>
</li>
</ol>
<h3 id="22-tccr0a---timercounter-control-register-a"><a class="header" href="#22-tccr0a---timercounter-control-register-a">2.2 TCCR0A - Timer/Counter Control Register A</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Bit</th><th>7</th><th>6</th><th>5</th><th>4</th><th>3</th><th>2</th><th>1</th><th>0</th></tr></thead><tbody>
<tr><td>Name</td><td>COM0A1</td><td>COM0A0</td><td>COM0B1</td><td>COM0B0</td><td>-</td><td>-</td><td>WGM01</td><td>WGM00</td></tr>
</tbody></table>
</div>
<ul>
<li>
<p><code>COM0A1</code>: Compare Output Mode for <code>OC0A</code>.</p>
<ul>
<li>
<p>Setting <code>COM0A1</code> to 1 enables non-inverting PWM output on <code>OC0A</code> (Pin <code>PD6</code>).</p>
<div id="admonition-note" class="admonition admonish-note" role="note" aria-labelledby="admonition-note-title">
<div class="admonition-title">
<div id="admonition-note-title">
<p>Note</p>
</div>
<a class="admonition-anchor-link" href="#admonition-note"></a>
</div>
<div>
<ul>
<li>In non-inverting mode, the output starts high at the beginning of the timer cycle and goes low when the timer reaches the value in <code>OCR0A</code>.</li>
<li>The duty cycle is therefore determined by the value in <code>OCR0A</code>: a higher value keeps the signal high for a longer portion of the cycle</li>
</ul>
</div>
</div>
</li>
</ul>
</li>
<li>
<p><code>WGM01</code> and <code>WGM00</code>: Waveform Generation Mode.</p>
<ul>
<li>Setting both <code>WGM01</code> and <code>WGM00</code> to 1 puts <code>Timer0</code> in <strong>Fast PWM mode</strong>.</li>
</ul>
</li>
</ul>
<h3 id="23tccr0b---timercounter-control-register-b"><a class="header" href="#23tccr0b---timercounter-control-register-b">2.3TCCR0B - Timer/Counter Control Register B</a></h3>
<div class="table-wrapper"><table><thead><tr><th>Bit</th><th>7</th><th>6</th><th>5</th><th>4</th><th>3</th><th>2</th><th>1</th><th>0</th></tr></thead><tbody>
<tr><td>Name</td><td>FOC0A</td><td>FOC0B</td><td>-</td><td>-</td><td>WGM02</td><td>CS02</td><td>CS01</td><td>CS00</td></tr>
</tbody></table>
</div>
<ul>
<li><code>CS02</code>:<code>CS00</code>: Clock Select bits.
<ul>
<li>Sets the prescaler to control the PWM frequency.</li>
<li>Example: Setting <code>CS01</code> and <code>CS00</code> to 1 (<code>CS01 | CS00</code>) applies a prescaler of 64 to the timer.</li>
</ul>
</li>
</ul>
<hr />
<h2 id="3-prescalers"><a class="header" href="#3-prescalers">3. Prescalers</a></h2>
<p>The <strong>prescaler</strong> in the ATmega328P (and similar microcontrollers) is a divider that reduces the main system clock <strong>frequency</strong> to a lower frequency for the timer. The prescaler allows you to control the frequency of the timer, which directly affects the speed of operations like <strong>PWM</strong> or delays that the timer generates.</p>
<h3 id="31-purpose-of-the-prescaler"><a class="header" href="#31-purpose-of-the-prescaler">3.1 Purpose of the Prescaler</a></h3>
<p>The microcontroller‚Äôs main clock frequency is often quite high (e.g., 16 MHz on the ATmega328P). Running the timer directly at this speed would result in very high-frequency signals, making it challenging to create longer delays or lower-frequency PWM signals. The prescaler helps by slowing down the timer, making it easier to generate slower or more manageable signals.</p>
<h3 id="32-how-the-prescaler-works"><a class="header" href="#32-how-the-prescaler-works">3.2 How the Prescaler Works</a></h3>
<p>The prescaler takes the main clock frequency and divides it by a specified factor, which is then used as the <strong>input clock</strong> for the timer. For example, if the system clock is 16 MHz and the prescaler is set to 64, then the timer operates at:</p>
<p>\[250,000\ Hz\ =\ \frac{16,000,000\ Hz}{64}\]</p>
<p>This effectively slows down the timer and allows more extended timing intervals or lower-frequency PWM output.</p>
<h3 id="34-prescaler-options-on-atmega328p"><a class="header" href="#34-prescaler-options-on-atmega328p">3.4 Prescaler Options on ATmega328P</a></h3>
<p>Each timer on the ATmega328P has several prescaler options, typically selectable by configuring specific bits in the <code>TCCR</code> (Timer/Counter Control Register).</p>
<div class="table-wrapper"><table><thead><tr><th>Prescaler</th><th>Timer</th></tr></thead><tbody>
<tr><td>No Prescaling</td><td>1</td></tr>
<tr><td>No Prescaling(direct clock input)</td><td>0, 2</td></tr>
<tr><td>8</td><td>0, 1, 2</td></tr>
<tr><td>64</td><td>0, 1, 2</td></tr>
<tr><td>256</td><td>0, 1, 2</td></tr>
<tr><td>1024</td><td>0, 1, 2</td></tr>
</tbody></table>
</div>
<h3 id="35-example-calculation-of-pwm-frequency-with-a-prescaler"><a class="header" href="#35-example-calculation-of-pwm-frequency-with-a-prescaler">3.5 Example Calculation of PWM Frequency with a Prescaler</a></h3>
<p>When using Fast PWM mode on an 8-bit timer, the PWM frequency can be calculated as:</p>
<p>\[PWM\ Frequency\ =\ \frac{CPU\ Clock\ Frequency}{Prescaler\ \cdot 256}\]</p>
<p>For example, with a 16 MHz CPU clock and a prescaler of 64:</p>
<p>\[976\ Hz \approx\ \frac{16,000,000\ Hz}{64\cdot 256}\]</p>
<p>This frequency can then be adjusted by changing the OCR(<code>OCR0A</code>) (Output Compare Register) values to control the duty cycle, with the prescaler setting determining the overall timing speed of the signal.</p>
<p>To set the prescaler for <code>Timer0</code> on the ATmega328P, you configure the <code>CS00</code>, <code>CS01</code>, and <code>CS02</code> bits in the <code>TCCR0B</code> register. Each combination of these bits determines a different prescaler value. Here‚Äôs how you can configure <code>Timer0</code> for prescalers of 8, 64, 256, and 1024.</p>
<h3 id="36-setting-the-prescaler-for-timer0"><a class="header" href="#36-setting-the-prescaler-for-timer0">3.6 Setting the Prescaler for <code>Timer0</code></a></h3>
<div class="table-wrapper"><table><thead><tr><th>CS02</th><th>CS01</th><th>CS00</th><th>Prescaler</th></tr></thead><tbody>
<tr><td>0</td><td>0</td><td>1</td><td>No prescaler (direct clock)</td></tr>
<tr><td>0</td><td>1</td><td>0</td><td>8</td></tr>
<tr><td>0</td><td>1</td><td>1</td><td>64</td></tr>
<tr><td>1</td><td>0</td><td>0</td><td>256</td></tr>
<tr><td>1</td><td>0</td><td>1</td><td>1024</td></tr>
</tbody></table>
</div>
<p>The following code snippets show how to set each prescaler in <code>TCCR0B</code>:</p>
<div id="admonition-code" class="admonition admonish-code" role="note" aria-labelledby="admonition-code-title">
<div class="admonition-title">
<div id="admonition-code-title">
<p>Code</p>
</div>
<a class="admonition-anchor-link" href="#admonition-code"></a>
</div>
<div>
<pre><code class="language-c">TCCR0B = (1 &lt;&lt; CS01); // Prescaler = 8

TCCR0B = (1 &lt;&lt; CS01) | (1 &lt;&lt; CS00); // Prescaler = 64

TCCR0B = (1 &lt;&lt; CS02); // Prescaler = 256

TCCR0B = (1 &lt;&lt; CS02) | (1 &lt;&lt; CS00); // Prescaler = 1024
</code></pre>
</div>
</div>
<hr />
<h2 id="4-building-the-pwmc-source-code"><a class="header" href="#4-building-the-pwmc-source-code">4. Building the <code>pwm.c</code> source code</a></h2>
<div id="admonition-warning" class="admonition admonish-warning" role="note" aria-labelledby="admonition-warning-title">
<div class="admonition-title">
<div id="admonition-warning-title">
<p>Warning</p>
</div>
<a class="admonition-anchor-link" href="#admonition-warning"></a>
</div>
<div>
<ul>
<li>Remember to include in your <code>PATH</code> <code>avr-gcc</code>, <code>avrdude</code> and <code>make</code></li>
<li>Open <code>~/.bashrc</code> and add the following lines, then save and run the command <code>source ~/.bashrc</code> to update the current session with the new <code>PATH</code>
<ul>
<li>Uni machines
<pre><code class="language-sh"># ~/.bashrc
export PATH=$PATH:"/c/ProgramData/arduino-ide-v2/Local/Arduino15/packages/arduino/tools/avr-gcc/7.3.0-atmel3.6.1-arduino7/bin"
export PATH=$PATH:"/c/ProgramData/arduino-ide-v2/Local/Arduino15/packages/arduino/tools/avr-dude/6.3.0-arduino17/bin"
export PATH=$PATH:"/c/Program Files/GCC-Windows-MingW-2.0.0/w64devkit/bin"
</code></pre>
</li>
<li>Your personal windows machine
<pre><code class="language-sh"># ~/.bashrc
export PATH=$PATH:"/c/Users/YOURUSERNAME/AppData/Local/Arduino15/packages/arduino/tools/avr-gcc/7.3.0-atmel3.6.1-arduino7/bin"
export PATH=$PATH:"/c/Users/YOURUSERNAME/AppDataLocal/Arduino15/packages/arduino/tools/avr-dude/6.3.0-arduino17/bin"
export PATH=$PATH:"/c/Program Files/w64devkit/bin"
</code></pre>
</li>
<li>You can install w64devkit from here:
<ul>
<li><a href="https://github.com/skeeto/w64devkit/releases">https://github.com/skeeto/w64devkit/releases</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<h3 id="41-basic-pwmino"><a class="header" href="#41-basic-pwmino">4.1 Basic pwm.ino</a></h3>
<p>Now we have an understanding of the what is going on under the hood we can convert this <code>pwm.ino</code> into and embedded version.</p>
<div id="admonition-code-1" class="admonition admonish-code" role="note" aria-labelledby="admonition-code-1-title">
<div class="admonition-title">
<div id="admonition-code-1-title">
<p>Code</p>
</div>
<a class="admonition-anchor-link" href="#admonition-code-1"></a>
</div>
<div>
<pre><code class="language-c">int pwmPin = 6;      // LED connected to digital pin 9

void setup() {
    pinMode(pwmPin, OUTPUT);  // sets the pin as output
    analogWrite(ledPin, 127); // analogRead values go from 0 to 1023, analogWrite values from 0 to 255
}

void loop(){}
</code></pre>
</div>
</div>
<div id="admonition-explanation" class="admonition admonish-example" role="note" aria-labelledby="admonition-explanation-title">
<div class="admonition-title">
<div id="admonition-explanation-title">
<p>Explanation</p>
</div>
<a class="admonition-anchor-link" href="#admonition-explanation"></a>
</div>
<div>
<p>Let's have a breakdown of what this is doing incomparison to the embedded version:</p>
<ul>
<li>
<p>PWM Configuration:</p>
<ul>
<li>
<p>Using <code>analogWrite(pwmPin, 127);</code> automatically configures PWM on pin 6 with a duty cycle of 50% (127 out of 255).</p>
</li>
<li>
<p><code>analogWrite()</code> abstracts away the details of configuring the timer registers (like <code>TCCR0A</code> and <code>TCCR0B</code>) and prescalers, making it simpler but less flexible.</p>
</li>
</ul>
</li>
<li>
<p>PWM Frequency and Prescaler:</p>
<ul>
<li>
<p>With <code>analogWrite()</code>, you don‚Äôt have control over the prescaler or the PWM frequency. Arduino‚Äôs default frequency for <code>Timer0</code> (used for pins 5 and 6) is typically around 976 Hz on an ATmega328P running at 16 MHz.</p>
</li>
<li>
<p>In the examples below, we can manually set <code>TCCR0B</code>, we will choose between different prescalers to adjust the PWM frequency. This will allow for finer control over the PWM signal characteristics.</p>
</li>
</ul>
</li>
</ul>
</div>
</div>
<h3 id="42-create-pwmc"><a class="header" href="#42-create-pwmc">4.2 Create <code>pwm.c</code></a></h3>
<ol>
<li>
<p>Create a new directory inside <code>embeddedC</code> called <code>pwm</code></p>
 <div id="admonition-terminal" class="admonition admonish-terminal" role="note" aria-labelledby="admonition-terminal-title">
 <div class="admonition-title">
 <div id="admonition-terminal-title">
<p>Terminal</p>
 </div>
 <a class="admonition-anchor-link" href="#admonition-terminal"></a>
 </div>
 <div>
<pre><code class="language-sh">$ mkdir -p ~/embeddedC/pwm &amp;&amp; cd embeddedC/pwm
</code></pre>
 </div>
 </div>
</li>
<li>
<p>Create a new file inside the the <code>pwm</code> directory called <code>pwm.c</code></p>
 <div id="admonition-code-2" class="admonition admonish-code" role="note" aria-labelledby="admonition-code-2-title">
 <div class="admonition-title">
 <div id="admonition-code-2-title">
<p>Code</p>
 </div>
 <a class="admonition-anchor-link" href="#admonition-code-2"></a>
 </div>
 <div>
<pre><code class="language-sh">$ touch pwm.c
</code></pre>
 </div>
 </div>
</li>
<li>
<p>Now it's time start wrighting out the program:</p>
 <div id="admonition-code-3" class="admonition admonish-code" role="note" aria-labelledby="admonition-code-3-title">
 <div class="admonition-title">
 <div id="admonition-code-3-title">
<p>Code</p>
 </div>
 <a class="admonition-anchor-link" href="#admonition-code-3"></a>
 </div>
 <div>
<pre><code class="language-c">#include &lt;avr/io.h&gt;

void PWM_Init()
{
    // Set PD6 (OC0A) as output
    DDRD |= (1 &lt;&lt; PD6); // PWM pin 6

    // Set Timer0 to Fast PWM mode with non-inverting output on OC0A
    TCCR0A = (1 &lt;&lt; COM0A1) | (1 &lt;&lt; WGM01) | (1 &lt;&lt; WGM00);

    // Set the prescaler to 64 for Timer0
    TCCR0B = (1 &lt;&lt; CS01) | (1 &lt;&lt; CS00);

    // Initialize with 0% duty cycle
    OCR0A = 0;
}

int main()
{
    PWM_Init(); // Initialize PWM on PD6

    while (1) {
        // Adjust OCR0A as needed for duty cycle from 0 to 255
        OCR0A = 127; // Example: 50% duty cycle
    }
}
</code></pre>
 </div>
 </div>
 <div id="admonition-explanation-of-code" class="admonition admonish-example" role="note" aria-labelledby="admonition-explanation-of-code-title">
 <div class="admonition-title">
 <div id="admonition-explanation-of-code-title">
<p>Explanation of code</p>
 </div>
 <a class="admonition-anchor-link" href="#admonition-explanation-of-code"></a>
 </div>
 <div>
<ol>
<li><strong>Setting PD6 as Output</strong>:
<ul>
<li><code>DDRD |= (1 &lt;&lt; PD6);</code> configures PD6 as an output pin to output the PWM signal.</li>
</ul>
</li>
<li><strong>Configuring Timer0 for Fast PWM Mode</strong>:
<ul>
<li><strong>TCCR0A</strong>:
<ul>
<li><code>(1 &lt;&lt; COM0A1)</code>: Sets non-inverting mode for PWM on OC0A.</li>
<li><code>(1 &lt;&lt; WGM01) | (1 &lt;&lt; WGM00)</code>: Sets Fast PWM mode.</li>
</ul>
</li>
<li><strong>TCCR0B</strong>:
<ul>
<li><code>(1 &lt;&lt; CS01) | (1 &lt;&lt; CS00)</code>: Sets a prescaler of 64, controlling the PWM frequency.
. <strong>Setting the Duty Cycle</strong>:</li>
</ul>
</li>
<li><strong>OCR0A</strong>: Controls the duty cycle. A value of 127 provides approximately a 50% duty cycle.</li>
<li><strong>Range</strong>: <code>OCR0A</code> can range from 0 to 255, where:
<ul>
<li><strong>0</strong>: 0% duty cycle (always low)</li>
<li><strong>127</strong>: 50% duty cycle</li>
<li><strong>255</strong>: 100% duty cycle (always high)</li>
</ul>
</li>
</ul>
</li>
</ol>
 </div>
 </div>
</li>
<li>
<p>We are now going to copy the <code>Makefile</code> from the <code>blink/</code> created last time, and replace all instances of <code>blink</code> with <code>pwm</code> using the regex feature:</p>
 <div id="admonition-terminal-1" class="admonition admonish-terminal" role="note" aria-labelledby="admonition-terminal-1-title">
 <div class="admonition-title">
 <div id="admonition-terminal-1-title">
<p>Terminal</p>
 </div>
 <a class="admonition-anchor-link" href="#admonition-terminal-1"></a>
 </div>
 <div>
<pre><code class="language-sh">$ cp ../blink/Makefile .
$ vim Makefile
</code></pre>
 </div>
 </div>
</li>
<li>
<p>Inside vim type the following an press enter to find all instances of <code>blink</code> with <code>pwm</code></p>
 <div id="admonition-terminal-2" class="admonition admonish-terminal" role="note" aria-labelledby="admonition-terminal-2-title">
 <div class="admonition-title">
 <div id="admonition-terminal-2-title">
<p>Terminal</p>
 </div>
 <a class="admonition-anchor-link" href="#admonition-terminal-2"></a>
 </div>
 <div>
<pre><code class="language-vim">:%s/\&lt;blink\&gt;/pwm/g
</code></pre>
<p><img src="./figures/makepwm.gif" alt="" /></p>
 </div>
 </div>
</li>
<li>
<p>Remember like with blink we need to compile and upload the code to the board, ensure it is plugged in, to find the com port on windows:</p>
<p><img src="./figures/windows_com_ports_list.png" alt="" /></p>
</li>
<li>
<p>If the COM port has changed remember to change it in the <code>Makefile</code></p>
 <div id="admonition-code-4" class="admonition admonish-code" role="note" aria-labelledby="admonition-code-4-title">
 <div class="admonition-title">
 <div id="admonition-code-4-title">
<p>Code</p>
 </div>
 <a class="admonition-anchor-link" href="#admonition-code-4"></a>
 </div>
 <div>
<pre><code class="language-Makefile">PORT = COM#
</code></pre>
 </div>
 </div>
</li>
<li>
<p>Use <code>make</code>:</p>
<ul>
<li><code>make clean</code></li>
<li><code>make</code></li>
<li><code>make upload</code></li>
</ul>
</li>
<li>
<p>Ensure you have wired up an led circuit in to pin 6 with a 220\(\Omega\) resistor</p>
</li>
</ol>
<hr />
<h2 id="5-exercises"><a class="header" href="#5-exercises">5. Exercises</a></h2>
<h3 id="51-exercise-1-changing-the-duty-cycle"><a class="header" href="#51-exercise-1-changing-the-duty-cycle">5.1 Exercise 1: Changing the Duty Cycle</a></h3>
<p>Modify the <code>OCR0A</code> register in the <code>main</code> loop to create different duty cycles. For example, try setting it to 64, 127, and 192. Observe how the brightness of an LED connected to PD6 changes.</p>
<p><strong>Task</strong>:</p>
<ul>
<li>Set <code>OCR0A = 64;</code> // ~25% duty cycle</li>
<li>Set <code>OCR0A = 192;</code> // ~75% duty cycle</li>
<li>Record the observed LED brightness.</li>
</ul>
<h3 id="52-exercise-2-creating-a-smooth-fade-effect"><a class="header" href="#52-exercise-2-creating-a-smooth-fade-effect">5.2 Exercise 2: Creating a Smooth Fade Effect</a></h3>
<p>Modify the code to gradually increase the duty cycle from 0 to 255 and then decrease it back to 0 to create a smooth "breathing" LED effect.</p>
<p><strong>Hint</strong>:</p>
<ul>
<li>
<p>Use a <code>for</code> loop to increment <code>OCR0A</code> from 0 to 255, adding a delay between each increment.</p>
</li>
<li>
<p>Then, use another <code>for</code> loop to decrement it from 255 back to 0.</p>
  <details id="admonition-suppress-code-here-31-lines" class="admonition admonish-code" role="note" aria-labelledby="admonition-suppress-code-here-31-lines-title">
  <summary class="admonition-title">
  <div id="admonition-suppress-code-here-31-lines-title">
<p>Suppress code here... [31 lines]</p>
  </div>
  <a class="admonition-anchor-link" href="#admonition-suppress-code-here-31-lines"></a>
  </summary>
  <div>
<pre><code class="language-c">#include &lt;avr/io.h&gt;

void PWM_Init()
{
    // Set PD6 (OC0A) as output
    DDRD |= (1 &lt;&lt; PD6); // PWM pin 6

    // Set Timer0 to Fast PWM mode with non-inverting output on OC0A
    TCCR0A = (1 &lt;&lt; COM0A1) | (1 &lt;&lt; WGM01) | (1 &lt;&lt; WGM00);

    // Set the prescaler to 64 for Timer0
    TCCR0B = (1 &lt;&lt; CS01) | (1 &lt;&lt; CS00);

    // Initialize with 0% duty cycle
    OCR0A = 0;
}

int main()
{
    PWM_Init(); // Initialize PWM on PD6

    while (1) {
        for (uint8_t i = 0; i &lt;= 255; i++) {
            OCR0A = i;
            _delay_ms(10); // Adjust delay as needed
        }
        for (uint8_t i = 255; i &gt; 0; i--) {
            OCR0A = i;
            _delay_ms(10); // Adjust delay as needed
        }
    }
}
</code></pre>
  </div>
  </details>
</li>
</ul>
<h3 id="53-exercise-3-changing-the-pwm-frequency"><a class="header" href="#53-exercise-3-changing-the-pwm-frequency">5.3 Exercise 3: Changing the PWM Frequency</a></h3>
<p>Experiment with different prescaler values to change the PWM frequency. Change the <strong>CS02:CS00</strong> bits in <strong>TCCR0B</strong> to see the effects.</p>
<p><strong>Task</strong>:</p>
<ul>
<li>Try prescalers of 8, 64, and 256, and observe how the frequency and brightness change.</li>
</ul>
<style>.scroll-to-top { font-size: 2.5rem; width: 3.2rem; height: 3.2rem; display: none; align-items: center; justify-content: center; position: fixed; padding: 0.75rem; bottom: 4rem; right: calc(1.25rem + 90px + var(--page-padding)); z-index: 999; cursor: pointer; border: none; color: var(--bg); background: var(--fg); border-radius: 50%; } .scroll-to-top.hidden { display: none; } .scroll-to-top i { transform: translateY(-2px); } @media (min-width: 1080px) { .scroll-to-top { display: flex; } }</style><button type="button" aria-label="scroll-to-top" class="scroll-to-top hidden" onclick="scrollToTop()"> <i class="fa fa-angle-up"></i></button><script>const scrollToTop = () => window.scroll({ top: 0, behavior: "smooth" }); window.addEventListener("scroll", () => { const button = document.querySelector(".scroll-to-top"); button.classList.toggle("hidden", window.scrollY <200); });</script><style>footer { text-align: center; text-wrap: balance; margin-top: 5rem; display: flex; flex-direction: column; justify-content: center; align-items: center; } footer p { margin: 0; }</style><footer><p>Copyright ¬© 2025 ‚Ä¢ Created with ‚ù§Ô∏è by <a href="https://github.com/CompEng0001">CompEng0001</a></p></footer>
<footer><span class="gitinfo-footer" style="font-size:0.8em;padding:4px;margin:0.5em 0;text-align:right;display:block;">Page last updated: Thursday 03 July 2025 @ 09:31:44 | Commit: 9463618</span></footer>
                    </main>
                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../EmbeddedC/adc.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../EmbeddedC/adc2pwm.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../EmbeddedC/adc.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../EmbeddedC/adc2pwm.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src=".././theme/pagetoc.js"></script>
        <script src=".././theme/highlightjs-line-numbers.js"></script>


    </div>
    </body>
</html>