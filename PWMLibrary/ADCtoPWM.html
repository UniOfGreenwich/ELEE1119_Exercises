<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>ADC to PWM Library - Advanced Computer Engineering</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href=".././theme/pagetoc.css">
        <link rel="stylesheet" href=".././theme/css/mdbook-admonish.css">
        <link rel="stylesheet" href=".././theme/css/code.css">
        <link rel="stylesheet" href=".././theme/css/terminal.css">
        <link rel="stylesheet" href=".././theme/css/output.css">
        <link rel="stylesheet" href=".././theme/css/film.css">
        <link rel="stylesheet" href=".././theme/css/mdbook-admonish.css">

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="dracula">Dracula</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="frappe">Frappé</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="kanagawa">Knagawa</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="macchiato">Macchiato</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="mocha">Mocha</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="pinkrose">Pinkrose</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="tender">Tender</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="tokyonight">Tokyonight</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Advanced Computer Engineering</h1>

                    <div class="right-buttons">
                        <a href="https://github.com/uniofgreenwich/ELEE1119_Exercises" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/uniofgreenwich/ELEE1119_Exercises/edit/main/content/PWMLibrary/ADCtoPWM.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="adc-to-pwm-functionality"><a class="header" href="#adc-to-pwm-functionality">ADC to PWM functionality</a></h1>
<h2 id="updating-the-pwm-library"><a class="header" href="#updating-the-pwm-library">Updating the PWM library</a></h2>
<p>We need to add the a new prototype to the <code>pwm.h</code> and the body to the <code>pwm.c</code> files, that converts the ADC value to a the correct PWM duty cycle against the specified period.</p>
<div id="admonition-note" class="admonition admonish-note" role="note" aria-labelledby="admonition-note-title">
<div class="admonition-title">
<div id="admonition-note-title">
<p>Note</p>
</div>
<a class="admonition-anchor-link" href="#admonition-note"></a>
</div>
<div>
<p>Remember that the Beaglebone blacks ADC chip does not use 8bit levels, i.e 0-255 like you would find on a Arduino board. It uses provides the duty cycle as % of the period.</p>
</div>
</div>
<ol>
<li>
<p>Open the <code>pwm.h</code> file and modify to include the prototype below called <code>map</code>:</p>
 <details id="admonition-suppressed-code-here-7-lines" class="admonition admonish-code" role="note" aria-labelledby="admonition-suppressed-code-here-7-lines-title">
 <summary class="admonition-title">
 <div id="admonition-suppressed-code-here-7-lines-title">
<p>Suppressed code here [7 lines]</p>
 </div>
 <a class="admonition-anchor-link" href="#admonition-suppressed-code-here-7-lines"></a>
 </summary>
 <div>
<pre><code class="language-h">#ifndef PWM_H
#define PWM_H

...

unsigned int map(u_int16_t adc_value, unsigned int period_ns);

#endif
</code></pre>
 </div>
 </details>
</li>
<li>
<p>Next we need to modify the <code>pwm.c</code> file to include the body of the previously defined prototype, place the function at the bottom of the file:</p>
 <details id="admonition-suppressed-code-here-14-lines" class="admonition admonish-code" role="note" aria-labelledby="admonition-suppressed-code-here-14-lines-title">
 <summary class="admonition-title">
 <div id="admonition-suppressed-code-here-14-lines-title">
<p>Suppressed code here [14 lines]</p>
 </div>
 <a class="admonition-anchor-link" href="#admonition-suppressed-code-here-14-lines"></a>
 </summary>
 <div>
<pre><code class="language-c">... 

// Map ADC value to PWM duty cycle with user-specified period
unsigned int map(u_int16_t adc_value, unsigned int period_ns) {

    if (adc_value &gt; 4095) {
        fprintf(stderr, "ADC value out of range\n");
        return 1;
    }

    // Map ADC value (0 to 4095) to PWM duty cycle (0 to period_ns)
    unsigned int duty_cycle_ns = (adc_value * period_ns) / 4095;

    return duty_cycle_ns;
}
</code></pre>
 </div>
 </details>
</li>
<li>
<p>Now you need to remake the library:</p>
 <div id="admonition-terminal" class="admonition admonish-terminal" role="note" aria-labelledby="admonition-terminal-title">
 <div class="admonition-title">
 <div id="admonition-terminal-title">
<p>Terminal</p>
 </div>
 <a class="admonition-anchor-link" href="#admonition-terminal"></a>
 </div>
 <div>
<pre><code class="language-sh">$ make clean
$ make uninstall
$ make install
</code></pre>
 </div>
 </div>
</li>
</ol>
<hr />
<h2 id="implementing-an-example"><a class="header" href="#implementing-an-example">Implementing an example</a></h2>
<ol start="4">
<li>
<p>We are going to create a script that utlises what we did for <code>adc_read.c</code> and <code>pwm_test.c</code>, by utilising both libraries <code>pwm.h</code> and <code>adc.h</code>.</p>
<details id="admonition-suppressed-code-here-61-lines" class="admonition admonish-code" role="note" aria-labelledby="admonition-suppressed-code-here-61-lines-title">
<summary class="admonition-title">
<div id="admonition-suppressed-code-here-61-lines-title">
<p>Suppressed code here [61 lines]</p>
</div>
<a class="admonition-anchor-link" href="#admonition-suppressed-code-here-61-lines"></a>
</summary>
<div>
<pre><code class="language-c">#include "pwm.h"
#include "adc.h"
#include &lt;stdio.h&gt;
#include &lt;unistd.h&gt;
#include &lt;stdint.h&gt;

int main() {
    PWM pwm;
    unsigned int adc_reading = 0;
    unsigned int user_defined_period_ns = 100000; // User-defined period in nanoseconds (1 ms for 1 kHz)
    unsigned int duty_cycle = 0;

    // Initialize PWM on a specified pin, for example "P8_13"
    pwm_init(&amp;pwm, "P8_13");

    // Set initial PWM period
    pwm_set_period(&amp;pwm, user_defined_period_ns);

    // Enable PWM output
    pwm_enable(&amp;pwm);

    qprintf("Phy: %s\nChannel: %s\nChip: %s\nPeriod path: %s\nDuty Cycle path: %s\nEnable path: %s\nPin Mode Path: %s\nPin Mode Sate: %s\n",pwm.phy_pin,pwm.channel,pwm.chip,pwm.period_path,pwm.duty_cycle_path,pwm.enable_path,pwm.pin_mode_path, pwm.pin_mode_state);

    // Loop to read ADC values and update PWM duty cycle
    for (int i = 0; i &lt; 30; i++) {
        adc_get_value(0, &amp;adc_reading); // Read ADC value from channel 0
        printf("ADC Reading: %u\n", adc_reading);

        // Map the ADC reading to the PWM duty cycle and update it
        duty_cycle = map(adc_reading, user_defined_period_ns);

        pwm_set_duty_cycle(&amp;pwm, duty_cycle);

        sleep(1); // Update every 1 second
    }

    // Disable PWM and clean up
    pwm_disable(&amp;pwm);
    pwm_cleanup(&amp;pwm);

    return 0;
}
</code></pre>
</div>
</details>
</li>
<li>
<p>Remember to create a <code>Makefile</code> file:</p>
 <details id="admonition-suppressed-code-here-25-lines" class="admonition admonish-code" role="note" aria-labelledby="admonition-suppressed-code-here-25-lines-title">
 <summary class="admonition-title">
 <div id="admonition-suppressed-code-here-25-lines-title">
<p>Suppressed code here [25 lines]</p>
 </div>
 <a class="admonition-anchor-link" href="#admonition-suppressed-code-here-25-lines"></a>
 </summary>
 <div>
<pre><code class="language-makefile"># Compiler and flags
CC = gcc
CFLAGS = -Wall -Werror

# Target executable name
TARGET = adc2pwm

# Source files
SRC = adc2pwm.c

# Library to link against
LIBS = -lioctrl

# Default target: build the executable
all: $(TARGET)

# Build the executable
$(TARGET): $(SRC)
        $(CC) $(CFLAGS) $(SRC) $(LIBS) -o $(TARGET)

# Clean up build artifacts
clean:
        rm -f $(TARGET)

# Phony targets to avoid conflicts with files of the same name
.PHONY: all clean
</code></pre>
 </div>
 </details>
</li>
<li>
<p>If all is well, and you have connected up your circuity correctly, the LED should change it's brightness based on the resistance from the potentiometer, for example you may see this terminal output:</p>
<details id="admonition-output" class="admonition admonish-output" role="note" aria-labelledby="admonition-output-title">
<summary class="admonition-title">
<div id="admonition-output-title">
<p>Output</p>
</div>
<a class="admonition-anchor-link" href="#admonition-output"></a>
</summary>
<div>
<pre><code>PWM initialized with:
Physical Pin: P8_13
Channel: 7
Chip: 1
Period path: /sys/class/pwm/pwm-7:1/period
Duty Cycle path: /sys/class/pwm/pwm-7:1/duty_cycle
Enable path: /sys/class/pwm/pwm-7:1/enable
ADC Reading: 0
ADC Reading: 0
ADC Reading: 283
ADC Reading: 697
ADC Reading: 1313
ADC Reading: 1674
ADC Reading: 1907
ADC Reading: 2454
ADC Reading: 2968
ADC Reading: 3367
ADC Reading: 3687
ADC Reading: 3989
ADC Reading: 3920
ADC Reading: 4001
ADC Reading: 3932
ADC Reading: 3985
ADC Reading: 4002
ADC Reading: 4002
ADC Reading: 4001
...
</code></pre>
</div>
</details><style>.scroll-to-top { font-size: 2.5rem; width: 3.2rem; height: 3.2rem; display: none; align-items: center; justify-content: center; position: fixed; padding: 0.75rem; bottom: 4rem; right: calc(1.25rem + 90px + var(--page-padding)); z-index: 999; cursor: pointer; border: none; color: var(--bg); background: var(--fg); border-radius: 50%; } .scroll-to-top.hidden { display: none; } .scroll-to-top i { transform: translateY(-2px); } @media (min-width: 1080px) { .scroll-to-top { display: flex; } }</style><button type="button" aria-label="scroll-to-top" class="scroll-to-top hidden" onclick="scrollToTop()"> <i class="fa fa-angle-up"></i></button><script>const scrollToTop = () => window.scroll({ top: 0, behavior: "smooth" }); window.addEventListener("scroll", () => { const button = document.querySelector(".scroll-to-top"); button.classList.toggle("hidden", window.scrollY <200); });</script><style>footer { text-align: center; text-wrap: balance; margin-top: 5rem; display: flex; flex-direction: column; justify-content: center; align-items: center; } footer p { margin: 0; }</style><footer><p>Copyright © 2025 • Created with ❤️ by <a href="https://github.com/CompEng0001">CompEng0001</a></p></footer>
</li>
</ol>
<footer><span class="gitinfo-footer" style="font-size:0.8em;padding:4px;margin:0.5em 0;text-align:right;display:block;">Page last updated: Thursday 03 July 2025 @ 13:41:16 | Commit: d31d03a</span></footer>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../PWMLibrary/PWMLibrary.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../Libioctrl/Libioctrl.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../PWMLibrary/PWMLibrary.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../Libioctrl/Libioctrl.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src=".././theme/pagetoc.js"></script>
        <script src=".././theme/highlightjs-line-numbers.js"></script>


    </div>
    </body>
</html>