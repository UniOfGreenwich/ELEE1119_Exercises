<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>System Statistics Script - ELEE1119 Exercise Book</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../Shell/shell.html"><strong aria-hidden="true">1.</strong> Shell</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Shell/installation.html"><strong aria-hidden="true">1.1.</strong> Installation</a></li><li class="chapter-item expanded "><a href="../Shell/introducing_shell.html"><strong aria-hidden="true">1.2.</strong> Introducing the Shell</a></li><li class="chapter-item expanded "><a href="../Shell/fileDir.html"><strong aria-hidden="true">1.3.</strong> Navigating File and Directories</a></li><li class="chapter-item expanded "><a href="../Shell/create.html"><strong aria-hidden="true">1.4.</strong> Working with FIles and Directories</a></li><li class="chapter-item expanded "><a href="../Shell/pipefilter.html"><strong aria-hidden="true">1.5.</strong> Pipes and Filters</a></li><li class="chapter-item expanded "><a href="../Shell/loops.html"><strong aria-hidden="true">1.6.</strong> Loop</a></li><li class="chapter-item expanded "><a href="../Shell/scripts.html"><strong aria-hidden="true">1.7.</strong> Scripts</a></li><li class="chapter-item expanded "><a href="../Shell/find.html"><strong aria-hidden="true">1.8.</strong> Finding Things</a></li><li class="chapter-item expanded "><a href="../Shell/reference.html"><strong aria-hidden="true">1.9.</strong> Summary of Basic Commands</a></li></ol></li><li class="chapter-item expanded "><a href="../Shell_Extras/introduction.html"><strong aria-hidden="true">2.</strong> Extra Shell</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../Shell_Extras/manfiles.html"><strong aria-hidden="true">2.1.</strong> Manual Pages</a></li><li class="chapter-item expanded "><a href="../Shell_Extras/workremote.html"><strong aria-hidden="true">2.2.</strong> Working Remotely</a></li><li class="chapter-item expanded "><a href="../Shell_Extras/permissions.html"><strong aria-hidden="true">2.3.</strong> Permissions</a></li><li class="chapter-item expanded "><a href="../Shell_Extras/dirstruct.html"><strong aria-hidden="true">2.4.</strong> Working with Files and Directories</a></li><li class="chapter-item expanded "><a href="../Shell_Extras/jobs.html"><strong aria-hidden="true">2.5.</strong> Job Control</a></li><li class="chapter-item expanded "><a href="../Shell_Extras/aliases.html"><strong aria-hidden="true">2.6.</strong> Aliases and bash customisation</a></li><li class="chapter-item expanded "><a href="../Shell_Extras/shellvars.html"><strong aria-hidden="true">2.7.</strong> Shell Variables</a></li><li class="chapter-item expanded "><a href="../Shell_Extras/references.html"><strong aria-hidden="true">2.8.</strong> Summary of Commands</a></li></ol></li><li class="chapter-item expanded "><a href="../Shell_Style_Guide/shellstyleguide.html"><strong aria-hidden="true">3.</strong> Shell Style Guide</a></li><li class="chapter-item expanded "><a href="../System_Statistics_Script/systemStats.html" class="active"><strong aria-hidden="true">4.</strong> System Statistics Script</a></li><li class="chapter-item expanded "><a href="../RFC_Logger/rfclogger.html"><strong aria-hidden="true">5.</strong> RFC Logger Script</a></li><li class="chapter-item expanded "><a href="../OS_Pantheon/Introduction.html"><strong aria-hidden="true">6.</strong> OS Pantheon</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../OS_Pantheon/nixOS/nixOS.html"><strong aria-hidden="true">6.1.</strong> NixOS</a></li><li class="chapter-item expanded "><a href="../OS_Pantheon/arch/arch.html"><strong aria-hidden="true">6.2.</strong> Arch</a></li><li class="chapter-item expanded "><a href="../OS_Pantheon/RPIOS/rpios.html"><strong aria-hidden="true">6.3.</strong> Raspberry Pi OS</a></li><li class="chapter-item expanded "><a href="../OS_Pantheon/WindowsCoreIoT/WindowsCoreIoT.html"><strong aria-hidden="true">6.4.</strong> Windows Core IoT</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">ELEE1119 Exercise Book</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>So like last week we are going to keep adding to our script we created
using on JupyterHub.</p>
<blockquote>
<p><strong>NOTICE</strong></p>
<p>Jupyterhub link here: <a href="https://jupyterhub.canterbury.ac.uk/">https://jupyterhub.canterbury.ac.uk/</a></p>
<ol>
<li>
<p>Sign in with your CCCU Microsoft account.</p>
</li>
<li>
<p>In launcher menu click Terminal and Bash</p>
</li>
<li>
<p>Once in terminal mode, either make a directory () called 'AOS' or  navigate to it if you did this last
time ().</p>
</li>
<li>
<p>Now create a file called with by writing into the terminal , if you  already have a from last week do
the following and then .</p>
</li>
</ol>
<p>If you want to find more information about each command used, either use the <code>man &lt;cmd&gt;</code> or go to <a href="https://man7.org/linux/man-pages/">https://man7.org/linux/man-pages/</a> and search for them here.</p>
</blockquote>
<h1 id="script-header"><a class="header" href="#script-header">Script Header</a></h1>
<p>Once completed the script should output the following information to the terminal, as seen in below. Notice the run the script we use the <code>bash /path/to/script &lt;options&gt;</code> format.</p>
<p><img src="images/systemStats_output.PNG" alt="image" /></p>
<p>First of make sure your file looks like code shown below.</p>
<pre><code class="language-bash">#! /usr/bin/env bash
# CREATED BY: Name
# Date created: todays
# Version 0.1
# this script is designed to gather system statistics
</code></pre>
<p>In shell scripting comments, where the compiler ignores these lines, is defined as <code>#</code>. The first line is special as it points to the directive of the interpreter for the scripting language you are using, in this case <code>bash</code>. We call the <code>!#</code>  a hash-bang, shebang, hash-pling etc. The idea is it makes the shell script more like an executable file.</p>
<h1 id="global-variables"><a class="header" href="#global-variables">Global Variables</a></h1>
<p>Next we are going to define some variables, in bash all variables are, unless you specify that they are by defualt, <strong>global</strong>. Using the convention that <strong>global</strong> variables are defined as <strong>UPPERCASE</strong>. Incontrast <strong>local</strong> variables are defined using the self title keyword <code>local</code> and are written in <strong>lowercase</strong>.</p>
<pre><code class="language-bash">AUTHOR=&quot;Seb&quot;
VERSION=&quot;0.1&quot;
RELEASED=&quot;2022-02-09&quot;
</code></pre>
<p>Remember that bash is very particular language and whitespaces mean something. So make sure that variable for example have no spaces. We are going to use these variables later when we call for the version information of the script.</p>
<h1 id="usage-function"><a class="header" href="#usage-function">Usage function</a></h1>
<p>Now we are going to write a function that when called will display a help message on the terminal about the script, as example see below.</p>
<p><img src="images/systemStats_output_usage.PNG" alt="image" /></p>
<p>To do this we need to write the following code:</p>
<pre><code class="language-bash"># Display help message
USAGE(){
  echo -e $1
  echo -e &quot;\nUsage: systemStats [-c cores] [-D diskspace] [-i ipv4 address]&quot;
  echo -e &quot;\t\t   [-u cpu usage] [-v version]&quot;
  echo -e &quot;\t\t   more information see man systemStats&quot;
}
</code></pre>
<p>Similarly to global variables our function name is upper case as this is global too. The subsequent lines use the command <code>echo</code>  to output
information to standard out, or in this case the terminal. When supplied with the argument <code>-e</code> we enable the use of escape character such as:</p>
<blockquote>
<ul>
<li>
<p><code>\n</code> new line</p>
</li>
<li>
<p><code>\t</code> tab identation</p>
</li>
</ul>
</blockquote>
<p>The first line in the function means that the first, <code>$1</code>, argument passed into this function. The following lines will print out on a new line every time the   content in side the <code>&quot; &quot;</code> is passed into the <code>echo -e</code> . This information will tell the user of the script what arguments the script takes and the arguments descriptiors.</p>
<h1 id="error-checking"><a class="header" href="#error-checking">Error Checking</a></h1>
<p>Next we are going to some basic error checking.</p>
<pre><code class="language-bash"># check for arguments (error checking)
if [ $# -lt 1 ];then
    USAGE&quot;Not enough arguments&quot;
    exit 1
elif [ $# -gt 6 ];then
    USAGE &quot;Too many argurmnets supplied&quot;
    exit 1
elif [[ ( $1 == '-h') || ( $1 == '--help') ]];then
    USAGE &quot;Help!&quot;
    exit 0
fi
</code></pre>
<p>Conditional checks can be performed in many styles within bash, here we see two styles.</p>
<p>Firstly, <code>[ ]</code>, is the same as the <em>built-ins</em> <code>test</code> command. It supports single conditional checks, and subsequent checks must be performed in separate  brackets, separated by Boolean operators, <code>&amp;&amp;</code> and <code>||</code> doesn't support the NOT (<code>!</code>) operator. To invert a condition, use a <code>!</code>  outside the first bracket to use the shell's facility for inverting command return values.</p>
<p>Secondly, <code>[[ ]]</code> is bash-specific, though others shells may have implemented similar constructs. The operators <code>==</code>  and <code>!=</code>  apply bash pattern matching rules, see <strong>Pattern Matching</strong> in <code>man</code>. <code>bash</code> has a <code>=~</code> regex match operator allows use of parentheses and the <code>!</code>, <code>&amp;&amp;</code> and <code>||</code> logical operators within the brackets to combine subexpressions.</p>
<p>So back to first <code>if</code> condition and the first <code>elif</code> condition  and you can see that a check is made to see if the length of arguments,<code>$#</code> , is less than,<code>-lt</code>  and a separate check for greater than, <code>-gt</code>.</p>
<p>The final <code>elif</code> shows we are checking for a match in patterns that are <strong>not</strong> numeric. So the conditional check is comparative to see if <code>$1</code> matches either <code>-h</code> or <code>--helpS</code> .</p>
<p>Also, notice how we are using <code>exit 0</code> or <code>exit 1</code>, which indicates an error.</p>
<blockquote>
<p><strong>WOULD YOU LIKE TO KNOW MORE...?</strong></p>
<ul>
<li>
<p>Exit code 0 Success</p>
</li>
<li>
<p>Exit code 1 General &amp; miscellaneous errors, such as <em>divide by zero</em></p>
</li>
<li>
<p>Exit code 2 Misuse of shell built-ins Example: <code>empty_function()</code></p>
</li>
</ul>
</blockquote>
<h1 id="the-arguments"><a class="header" href="#the-arguments">The Arguments</a></h1>
<p>Remember earlier when we typed out the we added information about our arguments for this script? Well now are going to do this and use another function for bash called <code>getopts</code> as seen in the <code>while</code> loop on the first line of the code below.</p>
<blockquote>
<p><strong>WOULD YOU LIKE TO KNOW MORE..?</strong></p>
<ul>
<li>
<p><code>getopts</code> processes the positional parameters of the parent command. In bash, this is stored in the 
shell variable.</p>
<p><code>mycmd -a argument1 -b argument b </code></p>
</li>
<li>
<p>During the time that <code>mycmd</code> is running, the variable <code>$</code>contains the string:</p>
<p><code>-a argument1 -b &gt; argument2</code> </p>
</li>
<li>
<p>You can use<code>getopts</code> to parse this  string for options and arguments.</p>
</li>
</ul>
</blockquote>
<pre><code class="language-bash">while getopts cDiuv OPTION
do
case ${OPTION}
in
c) CORES=$(cat /sys/devices/system/cpu/present)
   echo&quot;Cores=&quot;${CORES};;
D) DISKSPACES=$(df -H  | grep -w 'overlay'| awk '{print &quot;Total: &quot;$2 &quot; Used: &quot;$3 &quot; Avail: &quot;$4}')
   echo -e &quot;Disk Info=&quot;${DISKSPACES};;
i) IP=$(hostname -I)
   echo &quot;Host IP=&quot;${IP};;
u) CPU_USAGE=$(grep -w 'cpu' /proc/stat | awk '{(usage=($2+$3+$4+$6+$7+$8)*100/($2+$3+$4+$5+$6+$7+$8))}
                      {free=($5)*100/($2+$3+$4+$5+$6+$7+$8)}
                      END {printf &quot; Used CPU: %.2f%%&quot;,usage}
                          {printf &quot; Free CPU: %.2f%%&quot;,free}')
   echo -e ${CPU_USAGE};;
v) echo -e &quot;systemStats:\n\t\tVersion:${VERSION} Released:${RELEASED} Author:${AUTHOR}&quot;;;
*) USAGE &quot;Option not recognised&quot;
esac
done
</code></pre>
<p>Breaking down this codes:</p>
<ul>
<li>
<p>The <code>while</code> construct iterates over all arguments supplied via the scripts invocation. Where the inputs are matched against those specified as argument to <code>getopts</code> the <code>OPTION</code> variable  stores the first or current argument supplied by the user, and then proceeds to the next one once the <code>case</code> has been matched.</p>
</li>
<li>
<p><code>case</code>  is the bash syntax for a <code>switch\case</code>statement, like you might have seen in <code>.NET</code></p>
</li>
<li>
<p>The first <em>case</em> that matches is executed when for example if  <code>OPTION == 'c'</code>. So if this is the case the code inside the case block is exectuted. In this example we are getting the number of cores the system has. Remember that <code>cat</code> is the Linux command for  concatenating a file for reading or writing to, you can see the expected output of this in the below image.</p>
</li>
</ul>
<p><img src="images/cpu_cores.PNG" alt="image" /></p>
<ul>
<li>The second case, <code>D) DISKSPACES</code>, uses the command <code>df</code>, which reports on the file system disk space. Using the <code>-H</code> option we are asking the command to  print sizes in powers of 1000 (e.g., 1.1G). Below is an image of the first part of the command before the <code>|</code>.</li>
</ul>
<p><img src="images/df_-H.PNG" alt="image" /></p>
<ul>
<li>The second part of the command uses the <code>grep</code> command with the option <code>-w</code> which uses regex to select only those lines containing matches that form whole words, in this case <strong>overlay</strong>. An output of this is shown below.</li>
</ul>
<p><img src="images/df_-H_grep.PNG" alt="image" /></p>
<ul>
<li>Finally, on this line of code the output of <code>df -H  | grep -w 'overlay' </code> is piped, <code>|</code> into <code>awk</code>. <code>awk</code> is another command that speicialises in textual data manipulation and is a very powerful tool. We are using it here to only get the fields 2, 3 and 4 (<code>$2 $3 $4</code>). </li>
</ul>
<p><img src="images/df_-H_grep_awk.PNG" alt="image" /></p>
<ul>
<li>
<p>The line that shows the case <code>i) IP</code> returns the IP address using the <code>hostame</code> comand with the option <code>-I</code> which specificaly retruns the class 4 address. </p>
</li>
<li>
<p>The second to last case, <code>u) CPU_USAGE....</code> returns the current % of the CPU in use and idle. This section of code looks complex, but we are again using <code>grep</code> to return on the line of data that has the word CPU from the <code>/proc/stat</code> file. The output of the <code>grep</code> command will be piped into <code>awk</code> and <code>awk</code> performs so maths to deterime each of the following, CPU in used and CPU that is free(idle). See below for two stages of the command.</p>
</li>
</ul>
<p><img src="images/grep_proc_stat.PNG" alt="images" /></p>
<ul>
<li><a href="https://www.linuxhowtos.org/System/procstat.htm">https://www.linuxhowtos.org/System/procstat.htm</a> provides further information on the meaning of the fields returned.</li>
</ul>
<p><img src="images/grep_proc_stat_awk.PNG" alt="images" /></p>
<ul>
<li>
<p>Penultimately, <code>v) echo -e ...</code> returns our saved global variables from earlier. These variables provide information about the version, authors etc of the script.</p>
</li>
<li>
<p>Finally, <code>*)</code>, means all other options are bad and as such we should return this to the user using the <code>USAGE()</code> we made earlier.</p>
</li>
</ul>
<blockquote>
<p><strong>WOULD YOU LIKE TO KNOW MORE...?</strong></p>
<ul>
<li>
<p>What happens when you change the order of the options supplied to the script?</p>
</li>
<li>
<p>Can you do an option more than once?</p>
</li>
<li>
<p>What else could you add to the script to increase its functionality?</p>
</li>
</ul>
</blockquote>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../Shell_Style_Guide/shellstyleguide.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../RFC_Logger/rfclogger.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../Shell_Style_Guide/shellstyleguide.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../RFC_Logger/rfclogger.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
