<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>RFC Logger - Advanced Computer Engineering</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item affix "><li class="spacer"></li><li class="chapter-item affix "><li class="spacer"></li><li class="chapter-item "><a href="../Introduction/Introduction.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item affix "><li class="spacer"></li><li class="chapter-item affix "><li class="spacer"></li><li class="chapter-item affix "><li class="part-title">Debian Rock C4</li><li class="chapter-item "><a href="../Debian_Rock/Debian_Rock.html"><strong aria-hidden="true">2.</strong> Debian Rock C4</a></li><li class="chapter-item "><a href="../tmux/tmux.html"><strong aria-hidden="true">3.</strong> Terminal Multiplexing</a></li><li class="chapter-item "><a href="../vim/vim.html"><strong aria-hidden="true">4.</strong> vim</a></li><li class="chapter-item "><div><strong aria-hidden="true">5.</strong> Fork Bomb</div></li><li class="chapter-item "><div><strong aria-hidden="true">6.</strong> Multi-Threading 1</div></li><li class="chapter-item "><div><strong aria-hidden="true">7.</strong> Multi-Threading 2</div></li><li class="chapter-item "><div><strong aria-hidden="true">8.</strong> System Calls</div></li><li class="chapter-item "><div><strong aria-hidden="true">9.</strong> Daemons</div></li><li class="chapter-item "><div><strong aria-hidden="true">10.</strong> UUID</div></li><li class="chapter-item affix "><li class="spacer"></li><li class="chapter-item affix "><li class="spacer"></li><li class="chapter-item affix "><li class="part-title">BeagleBoard</li><li class="chapter-item "><a href="../ChipExploration/ChipExploration.html"><strong aria-hidden="true">11.</strong> Exploring the Chips</a></li><li class="chapter-item "><a href="../PinExploration/PinExploration.html"><strong aria-hidden="true">12.</strong> PinExploration</a></li><li class="chapter-item "><a href="../GPIOLibrary/GPIOLibrary.html"><strong aria-hidden="true">13.</strong> GPIO C Library</a></li><li class="chapter-item "><a href="../ADCLibrary/ADCLibrary.html"><strong aria-hidden="true">14.</strong> ADC C Library</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="../ADCLibrary/ADCContinous.html"><strong aria-hidden="true">14.1.</strong> ADC Continous </a></li></ol></li><li class="chapter-item "><a href="../PWMLibrary/PWMLibrary.html"><strong aria-hidden="true">15.</strong> PWM C Library</a></li><li class="chapter-item "><div><strong aria-hidden="true">16.</strong> libioctrl</div></li><li class="chapter-item "><div><strong aria-hidden="true">17.</strong> USB Ethernet</div><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><div><strong aria-hidden="true">17.1.</strong> USB to Ethernet sniffing tool</div></li></ol></li><li class="chapter-item "><div><strong aria-hidden="true">18.</strong> Mounting an SD</div></li><li class="chapter-item affix "><li class="spacer"></li><li class="chapter-item affix "><li class="spacer"></li><li class="chapter-item affix "><li class="part-title">C</li><li class="chapter-item "><div><strong aria-hidden="true">19.</strong> Learning C</div></li><li class="chapter-item "><div><strong aria-hidden="true">20.</strong> Programming Computers</div></li><li class="chapter-item affix "><li class="spacer"></li><li class="chapter-item affix "><li class="spacer"></li><li class="chapter-item affix "><li class="part-title">Rust</li><li class="chapter-item "><div><strong aria-hidden="true">21.</strong> Intro to Rust</div></li><li class="chapter-item affix "><li class="spacer"></li><li class="chapter-item affix "><li class="spacer"></li><li class="chapter-item affix "><li class="part-title">Bourne Again SHell</li><li class="chapter-item "><a href="../Redirection/Redirection.html"><strong aria-hidden="true">22.</strong> Redirection</a></li><li class="chapter-item "><a href="../Bash/Bash_Scripting.html"><strong aria-hidden="true">23.</strong> Bash</a></li><li class="chapter-item "><a href="../ManPages/ManPages.html"><strong aria-hidden="true">24.</strong> Man Pages</a></li><li class="chapter-item "><a href="../SystemsStats/SystemsStats.html"><strong aria-hidden="true">25.</strong> Systems Stats Script</a></li><li class="chapter-item expanded "><a href="../RFC_Logger/rfclogger.html" class="active"><strong aria-hidden="true">26.</strong> RFC Logger</a></li><li class="chapter-item affix "><li class="spacer"></li><li class="chapter-item affix "><li class="spacer"></li><li class="chapter-item affix "><li class="part-title">Git</li><li class="chapter-item "><a href="../myFirstRepository/myFirstRepository.html"><strong aria-hidden="true">27.</strong> My First Repository</a></li><li class="chapter-item "><a href="../BranchingModel/BranchingModel.html"><strong aria-hidden="true">28.</strong> Branching-Strategy</a></li><li class="chapter-item "><a href="../OneFlow/OneFlow.html"><strong aria-hidden="true">29.</strong> Git Oneflow</a></li><li class="chapter-item "><a href="../AntiPatterns/AntiPatterns.html"><strong aria-hidden="true">30.</strong> Anti Patterns</a></li><li class="chapter-item "><a href="../ContinousDeployment/ContinousDeployment.html"><strong aria-hidden="true">31.</strong> Continous Deployment</a></li><li class="chapter-item "><a href="../ReleaseDeployment/ReleaseDeployment.html"><strong aria-hidden="true">32.</strong> Release Deployment</a></li><li class="chapter-item "><a href="../Migration/Migration.html"><strong aria-hidden="true">33.</strong> Migration</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Advanced Computer Engineering</h1>

                    <div class="right-buttons">

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>In this lab you will implement the Internet Engineering Taskforce RFC 5424 standard for syslog using <code>bash</code>. You can just blind copy the code and place them in descending order into your script, but remember to read around each code block so you understand it.</p>
<blockquote>
<p><strong>NOTICE</strong></p>
<p>Be prepared to see a more advanced level of bash scripting through this exercise, as this is a stage 6 module you are expected to learn at higher level.</p>
<p>Also, this lab is essential for the assignment.</p>
<p>Once you have followed this document you will be provided with a file that you can then test the output of the script.</p>
</blockquote>
<h1 id="getting-started"><a class="header" href="#getting-started">Getting Started</a></h1>
<p>Open a terminal and make a directory in your <code>$HOME</code> directory and call it <code>ELEE1119/</code> if you havent got one already,
using the <code>mkdir ELEE1119</code> command in the terminal in JupyterHub.</p>
<p>Next you will need to create a child directory inside <code>ELEE1119</code> called <code>logging</code>.</p>
<p>From here you can either navigate to this newly created child directory using <code>cd ELEE1119/logging</code> if you are in the <code>$HOME</code> directory still.</p>
<p>Now pick your favourite text editor(nano, vim, etc) or find an IDE installed on the system. Then create a new shell script like this <code>&lt;editor&gt; rfclogger.sh</code> where the <code>&lt;editor&gt;</code> is nano, vim, etc.</p>
<p>At the top we need a sha-bang to point the location of the bash compiler.</p>
<pre><code class="language-bash">#! /usr/bin/env bash
# Fail on first error
set -e
</code></pre>
<p>This may be the first time you have seen <code>set</code>, a <em>builtin</em>. Essentially, lets you set or unset values of shell options and positional parameters, in this instance we are seting the parameter as <code>-e</code> which means exit immediately if a command exits with a non-zero status.</p>
<blockquote>
<p>WANT TO KNOW MORE</p>
<p>You can always view the help or manual page in the terminal command line) by either:</p>
<ul>
<li>
<p><code>man &lt;cmd&gt;</code></p>
</li>
<li>
<p><code>&lt;cmd&gt; &lt;--help || -h &gt;</code></p>
</li>
<li>
<p>For instance <code>set --help</code></p>
</li>
</ul>
</blockquote>
<h1 id="configurables"><a class="header" href="#configurables">Configurables</a></h1>
<p>A quick reminder here that <code>#</code> is a comment for one line. This bit is essential for running the script but it may help if you come to revisit at a later date.</p>
<pre><code class="language-bash">#--------------------------------------------------------------------------------------------------
# Configurables

# RFC-5424 log levels
# -------------------
# DEBUG: Detailed debug information.
# INFO: Interesting events
# NOTICE: Normal but significant events.
# WARNING: Exceptional occurrences that are not errors
# ERROR: Runtime errors that do not require immediate action but
#        should typically be logged and monitored.
# CRITICAL: Critical conditions.
# ALERT: Action must be taken immediately.
# EMERGENCY: Emergency: System is unusable.
#
# An additional level OFF is added.
# When log level set to OFF no more messages are logged to the console
</code></pre>
<p>However, the following code is needed.</p>
<pre><code class="language-bash">
declare -A LOG_LEVELS
export LOG_LEVELS=([OFF]=8 [DEBUG]=7 [INFO]=6 [NOTICE]=5 [WARNING]=4
		   [ERROR]=3 [CRITICAL]=2 [ALERT]=1 [EMERGENCY]=0)
# Make sure that HOME exist
export HOME=${HOME:-$(getent passwd "$(whoami)" | cut -d: -f6)}

# Default formats
export DEF_LOG_FORMAT='%DATE %PID [%LEVEL] %MESSAGE'
# ISO 8601
export DEF_LOG_DATE_FORMAT='+%F %T %Z'
</code></pre>
<p>A few things to note,</p>
<ul>
<li>
<p><code>decalre</code> is a shell BUILTIN that allows the programmer to declare  variables and give them attributes. The option which sets the attribute is <code>-A</code> and makes the <code>LOG_LEVELS</code> variable an associative arrays. Where an associative array variable is used to store multiple data with index and the value of each array element is accessed by the corresponding index value of that element.</p>
</li>
<li>
<p>All global variables are in UPPERCASE, and as we will see later <code>local</code> variables are lowercase</p>
</li>
<li>
<p><code>export</code> is a BUILTIN command of the bash shell and other Bourne shell variants. It is used to mark a shell variable for export to child processes.</p>
</li>
</ul>
<blockquote>
<p><strong>WANT TO KNOW MORE</strong></p>
<p>Experiment with <code>getent</code>in a new terminal type the following:</p>
<ul>
<li><code>getent passwd "$(whoami)"</code></li>
</ul>
</blockquote>
<blockquote>
<p>What does it return? If you are unsure research to find out what the returned value(s) mean, then do the final part of the command:</p>
<ul>
<li><code>getent passwd "$(whoami)" | cut -d: -f6</code></li>
</ul>
<p>Do you understand how, if not research it?</p>
</blockquote>
<h2 id="function-for-log-variables"><a class="header" href="#function-for-log-variables">Function for Log Variables</a></h2>
<p>We are going to make our first function for this script.</p>
<pre><code class="language-bash"># Define LOG variables
LOG_VARS() {
    export LOG_LOGFILE_ENABLE=${LOG_LOGFILE_ENABLE:-1}  # Enable logging to file
    export LOGFILE=${LOGFILE:-"$HOME/tmp/bash-logger/my-bash-logger.log"}
    export LOG_FORMAT=${LOG_FORMAT:-$DEF_LOG_FORMAT}
    export LOG_DATE_FORMAT=${LOG_DATE_FORMAT:-$DEF_LOG_DATE_FORMAT} #Eg:2014-09-07 21:51:57
    export LOG_COLOR_ENABLE=${LOG_COLOR_ENABLE:-1}  # Enable colors by default
    export LOG_LEVEL=${LOG_LEVEL:-${LOG_LEVELS[DEBUG]}} # Logs all messages to the terminal
    export LOG_COLOR_DEBUG=${LOG_COLOR_DEBUG:-"\033[0;34m"} # Blue
    export LOG_COLOR_INFO=${LOG_COLOR_INFO:-"\033[0;37m"}  # White
    export LOG_COLOR_NOTICE=${LOG_COLOR_NOTICE:-"\033[1;32m"} # Green
    export LOG_COLOR_WARNING=${LOG_COLOR_WARNING:-"\033[1;33m"} # Yellow
    export LOG_COLOR_ERROR=${LOG_COLOR_ERROR:-"\033[1;31m"}  # Red
    export LOG_COLOR_CRITICAL=${LOG_COLOR_CRITICAL:-"\033[44m"} # Blue Background
    export LOG_COLOR_ALERT=${LOG_COLOR_ALERT:-"\033[45m"} # Purple Background
    export LOG_COLOR_EMERGENCY=${LOG_COLOR_EMERGENCY:-"\033[41m"} # Red Background
    export RESET_COLOR=${RESET_COLOR:-"\033[0m"}
}

# Set LOG variables
LOG_VARS
</code></pre>
<ul>
<li>
<p>Bash colours(colors) are implemented when used in conjunction with
octal/ANSI escape codes <code>\033[0;34m</code>, see <a href="https://www.shellhacks.com/bash-colors/">https://www.shellhacks.com/bash-colors/</a> for further explanation.</p>
</li>
<li>
<p>If a variable isn't set earlier on or later by some other process of the user bash lets you apply a default value in case of this: So, if the <code>LOGFILE</code> is not initialised then <code>LOGFILE:-"$HOME/tmp/bash-logger/my-bash-logger.log"</code> will apply the default  log file path location as <code>$HOME/tmp/bash-logger/my-bash-logger.log</code>.</p>
</li>
<li>
<p>The last line here, <code>LOG_VARS</code> is how we call a function in a bash script</p>
</li>
</ul>
<h1 id="individual-log-functions"><a class="header" href="#individual-log-functions">Individual Log Functions</a></h1>
<p>Now we are going to be creating the 8 of the syslog logging levels with
an additional 1 to turnoff logging:</p>
<p>| OFF  | ERROR  |  CRITICAL |
| DEBUG   | INFO  |  ALERT |
| NOTICE  |  WARNING |  EMERGENCY |</p>
<pre><code class="language-bash">#----------------------------------------------------------------------------------------
# Individual Log Functions
# These can be overwritten to provide custom behavior for different log levels

OFF()       { LOG_HANDLER_DEFAULT "$FUNCNAME" "$@"; }
DEBUG()     { LOG_HANDLER_DEFAULT "$FUNCNAME" "$@"; }
INFO()      { LOG_HANDLER_DEFAULT "$FUNCNAME" "$@"; }
NOTICE()    { LOG_HANDLER_DEFAULT "$FUNCNAME" "$@"; }
WARNING()   { LOG_HANDLER_DEFAULT "$FUNCNAME" "$@"; }
ERROR()     { LOG_HANDLER_DEFAULT "$FUNCNAME" "$@"; exit 1; }
CRITICAL()  { LOG_HANDLER_DEFAULT "$FUNCNAME" "$@"; exit 1; }
ALERT()     { LOG_HANDLER_DEFAULT "$FUNCNAME" "$@"; exit 1; }
EMERGENCY() { LOG_HANDLER_DEFAULT "$FUNCNAME" "$@"; exit 1; }
</code></pre>
<p>So again probably some new syntax and commands are standing out.</p>
<ul>
<li>
<p><code>$FUNCNAME</code> contains the names of shell functions on the execution call stack, it can store an array of functions.</p>
</li>
<li>
<p><code>$@</code> expands into a list of separate parameters, where as <code>$*</code> is one  parameter consisting of all the parameters added together.</p>
</li>
<li>
<p>Hopefully you remember from other content you have learned at UoG that <code>exit 0</code> and is explicit means no error, exit 1 is an error and is implicit.</p>
</li>
</ul>
<h1 id="helper-functions"><a class="header" href="#helper-functions">Helper Functions</a></h1>
<p>Here the we will have some helper functions to that include the actual log function and level and level name.</p>
<p>Instead of showing it all in one dump, we will do each one individually.</p>
<pre><code class="language-bash">#-------------------------------------------------------------------------------------------
# Helper Functions

# Outputs a log formatted using the LOG_FORMAT and DATE_FORMAT configurables
# Usage: FORMAT_LOG &lt;log level&gt; &lt;log message&gt;
# Eg: FORMAT_LOG CRITICAL "My critical log"
FORMAT_LOG() {
    local level="$1"
    local log="$2"
    local pid=$$
    local date="$(date "$LOG_DATE_FORMAT")"
    local formatted_log="$LOG_FORMAT"
    formatted_log="${formatted_log/'%MESSAGE'/$log}"
    formatted_log="${formatted_log/'%LEVEL'/$level}"
    formatted_log="${formatted_log/'%PID'/$pid}"
    formatted_log="${formatted_log/'%DATE'/$date}" 
    echo "$formatted_log"
}
</code></pre>
<p>So the above code sets out how we want the log format to look like,<code>see the third line of code above</code> gives an example of usage. Below you can see the output on the
terminal when the <code>bash</code> is passed the <code>-x</code> option, like debugging.</p>
<p><img src="images/format_log.png" alt="image" /></p>
<p>For example the above shows the output of <code>FORMAT_LOG</code> when the script is called using <code>bash -x ./rfclogger.sh</code></p>
<pre><code class="language-bash"># Calls one of the individual log functions
# Usage: LOG &lt;log level&gt; &lt;log message&gt;
# Eg: LOG INFO "My info log"
LOG() {
    local level="$1"
    local log="$2"
    local log_function_name="${level^^}"
    $log_function_name "$log"
}
</code></pre>
<p>Only special functionality is the special characters on line <code>7</code> of the above code, <code>"...${level^^}"</code> where the caret symbols <code>^^</code> is shorthand for force to UPPERCASE the value in the variable <code>level</code>.</p>
<pre><code class="language-bash"># Get the level value from level name
# Eg: LOG_LEVEL_VALUE &lt;DEBUG | INFO | ...&gt;
LOG_LEVEL_VALUE() {
    local level="${1}"
    [ -z "${LOG_LEVELS[$level]+isset}" ] &amp;&amp; return 1
    echo "${LOG_LEVELS[$level]}"
}
</code></pre>
<p>Only thing really to point out here is that <code>-z</code> checks to see if something is of length <strong>zero</strong>. The function <code>isset</code> checks checks whether a variable is set, which means that it has to be declared and is <strong>not</strong> NULL. Therefore, we can set value by default to <code>LOG_LEVELS</code> if the current <code>level</code> variable is NULL.</p>
<p><img src="images/log_level_val.PNG" alt="image" /></p>
<p>Again output shown when called with <code>bash -x</code></p>
<p>Next you are going to create function that gets the log name from the supplied numeric value.</p>
<pre><code class="language-bash"># Get log level name from numeric value.
# Eg: LOG_LEVEL_NAME &lt;0..7&gt;
LOG_LEVEL_NAME() {
    local level=""
    local value="${1}"
    for level in "${!LOG_LEVELS[@]}"; do
       [ "${LOG_LEVELS[$level]}" -eq "${value}" ] &amp;&amp; echo "${level}" &amp;&amp; return 0
    done
    return 1
}
</code></pre>
<h1 id="log-handlers"><a class="header" href="#log-handlers">Log Handlers</a></h1>
<p>We are almost there we a several more functions to write, some that are styling/formatting for colour capable terminals.</p>
<pre><code class="language-bash">#------------------------------------------------------------------------------------------
# Log Handlers

# All log levels call this handler (by default...)
# logging behavior
# Usage: LOG_HANDLER_DEFAULT &lt;log level&gt; &lt;log message&gt;
# Eg: LOG_HANDLER_DEFAULT DEBUG "My debug log"
LOG_HANDLER_DEFAULT() {
    # From pipe
    if [ -p /dev/stdin ]; then
        local level="$1"
        shift
        while read -r line; do
            args=()
            if [ -n "$*" ]; then
                args+=( "$@" )
            fi
            args+=( "${line}" );
            LOG_HANDLER_OUT "$level" "${args[*]}"
        done
    # Normal log
    else
        LOG_HANDLER_OUT "$@"
    fi
}
</code></pre>
<p>There appears to be a fair amount going on here, but rest assured the structure of the code and commands used therein are pretty much self explanatory. But as always here is an explanation for each key point.</p>
<ul>
<li>
<p>the line with the <code>if</code> condition, <code>-p</code> is the the flag for pipe and is checking for a piped  instance in stdin. A note here <code>/dev/stdin</code> is unique because it is a symbolic link to <code>/proc/self/fd/0</code> and <code>/proc/self</code> is a symbolic link only seen by your running  process to its process-id. The <code>/proc</code> filesystem is a virtual (not real) file system which has the ability to show a different view to each process.</p>
</li>
<li>
<p><code>shift</code> is a BUILTIN command of the Bash shell. When executed, it shifts the positional parameters (such as arguments passed to a bash script) to the left, putting each parameter in a lower position.</p>
</li>
<li>
<p>the next <code>if</code> condition checks to see if all arguments are <strong>not</strong>, <code>-n</code>, empty.</p>
</li>
</ul>
<p>Below you will see an the output of the <code>if</code> statement in action.</p>
<p><img src="images/log_handler_defualt_pipe.PNG" alt="when called using" /></p>
<p>So now we have a function that will handle for colour (color) and non-colour (color) terminals. You can see that a check is made on the first <code>if</code> condition where <code>-eq</code> means equals and it is used for numerical comparison.</p>
<pre><code class="language-bash"># Used by LOG_HANDLER_DEFAULT to output the log
LOG_HANDLER_OUT(){
    local level="$1"
    local formatted_log="$(FORMAT_LOG "$@")"
    if [ "${LOG_COLOR_ENABLE}" -eq "1" ]; then
            LOG_HANDLER_COLORTERM "$level" "$formatted_log"
    else
            LOG_HANDLER_TERM "$level" "$formatted_log"
    fi

    if [ "${LOG_LOGFILE_ENABLE}" -eq "1" ]; then
        LOG_HANDLER_LOGFILE "$level" "$formatted_log"
    fi
}
</code></pre>
<p>There is also a check for sending the log to a file on the filnal <code>if</code> statement.</p>
<p>The below code provides the functionality to match the level of logging to the colours defined correct colour.</p>
<pre><code class="language-bash"># Outputs a log to the stdout, colourised using the LOG_COLOR configurables
# Usage: LOG_HANDLER_COLORTERM &lt;log level&gt; &lt;log message&gt;
# Eg: LOG_HANDLER_COLORTERM CRITICAL "My critical log"
LOG_HANDLER_COLORTERM() {
    local level="$1"
    local level_value="$(LOG_LEVEL_VALUE "$level")"
    local log="$2"
    local color_variable="LOG_COLOR_$level"
    local color="${!color_variable}"
    log="$color$log$RESET_COLOR"

    [ "${LOG_LEVEL}" -eq "${LOG_LEVELS[OFF]}" ] &amp;&amp; return 0
    [ "${level_value}" -gt "$LOG_LEVEL" ] &amp;&amp; return 0
    echo -e "$log"
}
</code></pre>
<p>What we see from the above is that the log message is preceded by a colour and then at the end of the log message colour is returned to default, achieved by line with <code>og="$color$log$RESET_COLOR"</code>.</p>
<p>Furthermore, line with the code <code>[ "${LOG_LEVEL}" -eq "${LOG_LEVELS[OFF]}" ] &amp;&amp;return 0</code> performs a numerical comparison on the current <code>LOG_LEVEL</code>
to see if it matches the value OFF(8).</p>
<p>So we have four functions left...</p>
<p>Continuing with the handler theme, the next function is the <code>LOG_HANDLER_TERM</code>, essentially the same as the the <code>LOG_HANDLER_COLORTERM</code> but without the colour!</p>
<pre><code class="language-bash"># Outputs a log to the stdout, without color
# Usage: LOG_HANDLER_TERM &lt;log level&gt; &lt;log message&gt;
# Eg: LOG_HANDLER_TERM CRITICAL "My critical log"
LOG_HANDLER_TERM() {
    local level="$1"
    local level_value="$(LOG_LEVEL_VALUE "$level")"
    local log="$2"

    [ "${LOG_LEVEL}" -eq "${LOG_LEVELS[OFF]}" ] &amp;&amp; return 0
    [ "${level_value}" -gt "$LOG_LEVEL" ] &amp;&amp; return 0
    echo -e "$log"
}
</code></pre>
<p>Next function is the deals with the log file itself. Although line <code>locallevel="$1"</code> is not used, it is good to store the argument for future use...</p>
<pre><code class="language-bash"># Appends a log to the configured logfile
# Usage: LOG_HANDLER_LOGFILE &lt;log level&gt; &lt;log message&gt;
# Eg: LOG_HANDLER_LOGFILE NOTICE "My critical log"
LOG_HANDLER_LOGFILE() {
    local level="$1"
    local log="$2"
    local log_path="$(dirname "$LOGFILE")"
    [ -d "$log_path" ] || mkdir -p "$log_path"
    echo "$log" &gt;&gt; "$LOGFILE"
    LOG_ROTATION
}
</code></pre>
<p>Main things here are the checking if the file exists and if not create it as seen in lines <code>[ -d "$log_path" ] || mkdir -p "$log_path"</code>. Once the file and the message has been logged(line <code>echo"$log" &gt;&gt; "$LOGFILE"</code>) then the system will check to see if a rotation of logs is needed by calling the <code>LOG_ROTATION</code> function.</p>
<p>The <code>LOG_ROTATION</code> function will rotate the logs every 500 lines, you could modify this to change the value, line <code>if [[  ${log_size} -gt 500 ]];then</code>.</p>
<pre><code class="language-bash"># Rotates logs if current log is over 500 lines
LOG_ROTATION(){
    local log_size=$(wc -l $LOGFILE | awk '{print $1}')
    local count_log_files=$(ls ${LOGFILE%/*} | grep "${LOGFILE##/*}.*.gz" | wc -l )
    if [[ ${log_size} -gt 500 ]]; then
        if [ ${count_log_files} -gt 0 ]; then
            for ((i=${count_log_files}; i!=0; i--)); do
		            local n=$((${i}+1))
                    mv ${LOGFILE}.${i}.gz ${LOGFILE}.${n}.gz
            done
        fi
        gzip -c "${LOGFILE}" &gt; "${LOGFILE}.1.gz"
        echo "" &gt; ${LOGFILE}
   fi
}
</code></pre>
<p>Some explanation will be given for lines <code> local count_log_files=$(ls ${LOGFILE%/*} | grep "${LOGFILE##/*}.*.gz" | wc -l )</code> and <code>for ((i=${count_log_files}; i!=0; i--)); do</code>, the rest is self explanatory.</p>
<p>Line <code>local count_log_files=$(ls ${LOGFILE%/*} | grep "${LOGFILE##/*}.*.gz" | wc -l )</code> counts the number of files in the directory. First <code>ls</code> is passed the <code>LOGFILE</code> where only the directory remains <code>%/*</code>, then piped <code>|</code> into <code>grep</code> that the only looks for files that are <code>my-bash-logger.log.#.gz</code> where <code>#</code> is a number, this intern is piped to <code>wc</code> and the option <code>-l</code> will return the number of instances.</p>
<p>Line <code>for ((i=${count_log_files}; i!=0; i--)); do</code>, is a for loop in bash, this is one of several formats, we then decrement the total number of instances of a <code>...*.gz</code> files and then increment the actual file, (rotating).</p>
<p>Lastly, this final function, <code>unsets</code> all these <code>env</code> variables when called by the user.</p>
<pre><code class="language-bash"># Reset log variables to default values
LOG_RESET() {
    unset LOGFILE
    unset LOG_FORMAT
    unset LOG_DATE_FORMAT
    unset LOG_COLOR_ENABLE
    unset LOG_LEVEL
    unset LOG_COLOR_DEBUG
    unset LOG_COLOR_INFO
    unset LOG_COLOR_NOTICE
    unset LOG_COLOR_WARNING
    unset LOG_COLOR_ERROR
    unset LOG_COLOR_CRITICAL
    unset LOG_COLOR_ALERT
    unset LOG_COLOR_EMERGENCY
    unset RESET_COLOR

    LOG_VARS
}
</code></pre>
<blockquote>
<p><strong>WANT TO KNOW MORE</strong></p>
<p>Now that you have been through this document you can use the <code>example.sh</code> script to test the functionality of the <code>rfclogger.sh</code>.</p>
<p><img src="images/output.PNG" alt="Caption" /></p>
</blockquote>
<p>Download from here the files that we have built if you need too.</p>
<ul>
<li><a href="./rfclogger.sh">rfclogger.sh</a></li>
<li><a href="./example">example.sh</a></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../SystemsStats/SystemsStats.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../myFirstRepository/myFirstRepository.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../SystemsStats/SystemsStats.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../myFirstRepository/myFirstRepository.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
